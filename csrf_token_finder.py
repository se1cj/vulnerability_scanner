def detect_csrf_tokens(file_path):
    with open(file_path, 'r') as f:
        soup = BeautifulSoup(f, 'html.parser')
        # البحث عن كل الحقول المخفية
        tokens = soup.find_all('input', {'type': 'hidden'})
        # التحقق ما إذا كان الحقل يحتوي على رمز حماية CSRF
        csrf_protected = [token for token in tokens if '_csrf_token' in token.get('name', '')]
        return len(csrf_protected), len(tokens)

def scan_directory(directory):
    findings = {}
    for filename in os.listdir(directory):
        if filename.endswith('.html'):
            protected, total_hidden = detect_csrf_tokens(os.path.join(directory, filename))
            findings[filename] = {'Protected': protected, 'Total Hidden Fields': total_hidden}
    return findings
